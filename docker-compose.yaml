services:
  inventario:
    build: 
      context: ./microservizi/magazzino/inventario
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    networks:
      - net-magazzino
    environment:
      - PORT=3000
      - WAREHOUSE_ID=1
      - MONGO_URL=mongodb://mongo:27017/inventory
    volumes:
      - ./microservizi/magazzino/inventario/src:/usr/src/app/src
    depends_on:
      - mongo

  mongo:
    image: mongo:latest
    container_name: mongo
    ports:
      - "27017:27017"
    networks:
      - net-magazzino
    volumes:
      - ./microservizi/magazzino/mongo_db:/docker-entrypoint-initdb.d

  nats:
     image: nats:latest
     ports:
       - "4222:4222"
     networks:
       - net-magazzino

  api-gateway:
    image: devopsfaith/krakend
    container_name: api-gateway
    ports:
      - "8080:8080" # Gateway API
    networks:
      - net-magazzino
    depends_on:
      - inventario
      - nats
    volumes:
      - ./microservizi/api_gateway/krakend.json:/etc/krakend/krakend.json
    command: ["run", "-d", "-c", "/etc/krakend/krakend.json"]

networks:
  net-magazzino:    
    driver: bridge

  #--------------------------------------#

  # inventario-a:
  #   build: ./MagazzinoA/inventario-a
  #   image: swe/inventario-a
  #   ports:
  #     - "8080:3000"
  #   networks:
  #     - net-magazzino
  # ordini-a:
  #   build: ./MagazzinoA/ordini-a
  #   image: swe/ordini-a
  #   ports:
  #     - "8081:3000"
  #   networks:
  #     - net-magazzino


